function CanvasTurtle(e,t,n,r){function i(e){return e/180*Math.PI}function s(e){return e*180/Math.PI}function u(t,i){function s(t,n,r,i){if(o.filling){e.lineTo(t,n);e.lineTo(r,i)}else if(o.down){e.beginPath();e.moveTo(t,n);e.lineTo(r,i);e.stroke()}}var u,a,f,l,c,h,p;while(true){switch(o.turtlemode){case"window":s(o.x,o.y,t,i);o.x=t;o.y=i;return;default:case"wrap":case"fence":c=1;h=1;if(t<0){c=(o.x-0)/(o.x-t);if(o.x==t){c=1}}else if(t>=n){c=(o.x-n)/(o.x-t);if(o.x==t){c=1}}if(i<0){h=(o.y-0)/(o.y-i);if(o.y==i){h=1}}else if(i>=r){h=(o.y-r)/(o.y-i);if(o.y==i){h=1}}u=t;a=i;f=t;l=i;if(c<1&&c<=h){p=t<0;u=p?0:n;a=o.y-c*(o.y-i);t+=p?n:-n;f=p?n:0;l=a}else if(h<1&&h<=c){p=i<0;u=o.x-h*(o.x-t);a=p?0:r;i+=p?r:-r;f=u;l=p?r:0}s(o.x,o.y,u,a);if(o.turtlemode==="fence"){o.x=u;o.y=a;return}else{o.x=f;o.y=l;if(c===1&&h===1){return}}break}}}function f(e){if(a[e]!==undefined){return a[e]}else{var t=false;for(var n=0;n<16;n++){if(e==gt[a[n]]){t=true;this.color=a[n];break}}return this.color}}n=Number(n);r=Number(r);var o=this;this.move=function(e){var t,n,r,i,s,o=.001;r=Math.abs(e)<o;if(r){i=this.x;s=this.y;e=o}t=this.x+e*Math.cos(this.r);n=this.y-e*Math.sin(this.r);u(t,n);if(r){this.x=i;this.y=s}};this.turn=function(e){this.r-=i(e)};this.penup=function(){this.down=false};this.pendown=function(){this.down=true};this.setpenmode=function(t){this.penmode=t;e.globalCompositeOperation=this.penmode==="erase"?"destination-out":this.penmode==="reverse"?"xor":"source-over"};this.getpenmode=function(){return this.penmode};this.setturtlemode=function(e){this.turtlemode=e};this.getturtlemode=function(){return this.turtlemode};this.ispendown=function(){return this.down};var a={0:"black",1:"blue",2:"lime",3:"cyan",4:"red",5:"magenta",6:"yellow",7:"white",8:"brown",9:"tan",10:"green",11:"aquamarine",12:"salmon",13:"purple",14:"orange",15:"gray"};this.setcolor=function(t){this.color=f(t);e.strokeStyle=this.color;e.fillStyle=this.color};this.getcolor=function(){return this.color};this.setwidth=function(t){this.width=t;e.lineWidth=this.width};this.getwidth=function(){return this.width};this.setfontsize=function(t){this.fontsize=t;e.font=this.fontsize+"px sans-serif"};this.getfontsize=function(){return this.fontsize};this.setposition=function(e,t){e=e===undefined?this.x:e+n/2;t=t===undefined?this.y:-t+r/2;u(e,t)};this.towards=function(e,t){e=e+n/2;t=-t+r/2;return(90-s(Math.atan2(this.y-t,e-this.x))).toFixed(2)};this.setheading=function(e){this.r=i(90-e)};this.clearscreen=function(){this.home();this.clear()};this.clear=function(){e.clearRect(0,0,n,r);var t=e.fillStyle;e.fillStyle=this.bgcolor;e.fillRect(0,0,n,r);e.fillStyle=t};this.home=function(){u(n/2,r/2);this.r=i(90)};this.showturtle=function(){this.visible=true};this.hideturtle=function(){this.visible=false};this.isturtlevisible=function(){return this.visible};this.getheading=function(){var e=(90-s(this.r)).toFixed(2);while(e>360||e<0){if(e>360)e=parseFloat(e)-360;else e=parseFloat(e)+360}return e};this.getxy=function(){return[(this.x-n/2).toFixed(2),(-this.y+r/2).toFixed(2)]};this.drawtext=function(t){e.save();e.translate(this.x,this.y);e.rotate(-this.r);e.fillText(t,0,0);e.restore()};this.filling=0;this.beginpath=function(){if(this.filling===0){this.saved_turtlemode=this.turtlemode;this.turtlemode="window";++this.filling;e.beginPath()}};this.fillpath=function(t){--this.filling;if(this.filling===0){e.closePath();e.fillStyle=f(t);e.fill();e.fillStyle=this.color;if(this.down)e.stroke();this.turtlemode=this.saved_turtlemode}};this.fill=function(){e.floodFill(this.x,this.y)};this.arc=function(t,s){var o=this;if(this.turtlemode=="wrap"){[o.x,o.x+n,this.x-n].forEach(function(n){[o.y,o.y+r,this.y-r].forEach(function(r){if(!this.filling)e.beginPath();e.arc(n,r,s,-o.r,-o.r+i(t),false);if(!this.filling)e.stroke()})})}else{if(!this.filling)e.beginPath();e.arc(this.x,this.y,s,-this.r,-this.r+i(t),false);if(!this.filling)e.stroke()}};this.getstate=function(){return{isturtlestate:true,color:this.getcolor(),xy:this.getxy(),heading:this.getheading(),penmode:this.getpenmode(),turtlemode:this.getturtlemode(),width:this.getwidth(),fontsize:this.getfontsize(),visible:this.isturtlevisible(),pendown:this.down}};this.setstate=function(e){if(!e||!e.isturtlestate){throw new Error("Tried to restore a state that is not a turtle state")}this.penup();this.hideturtle();this.setturtlemode(e.turtlemode);this.setcolor(e.color);this.setwidth(e.width);this.setfontsize(e.size);this.setposition(e.xy[0],e.xy[1]);this.setheading(e.heading);this.setpenmode(e.penmode);if(e.visible){this.showturtle()}if(e.pendown){this.pendown()}};this.saveimage=function(){var e=canvas_todataurl;var t=false;if(window.XMLHttpRequest){ajax=new XMLHttpRequest}else if(window.ActiveXObject){ajax=new ActiveXObject("Microsoft.XMLHTTP")}ajax.open("POST","testSave.php",false);ajax.setRequestHeader("Content-Type","application/x-www-form-urlencoded");ajax.onreadystatechange=function(){console.log(ajax.responseText)};ajax.send("imgData="+e)};this.begin=function(){t.clearRect(0,0,n,r);e.fillText=e.fillText||function(t,n,r){}};this.end=function(){if(this.visible){var e=t;e.beginPath();e.moveTo(this.x+Math.cos(this.r)*20,this.y-Math.sin(this.r)*20);e.lineTo(this.x+Math.cos(this.r-Math.PI*2/3)*10,this.y-Math.sin(this.r-Math.PI*2/3)*10);e.lineTo(this.x+Math.cos(this.r+Math.PI*2/3)*10,this.y-Math.sin(this.r+Math.PI*2/3)*10);e.lineTo(this.x+Math.cos(this.r)*20,this.y-Math.sin(this.r)*20);e.stroke()}};e.lineCap="round";t.lineCap="round";t.strokeStyle="green";t.lineWidth=2;this.bgcolor="#ffffff";this.setcolor("#000000");this.setwidth(1);this.setpenmode("paint");this.setfontsize(14);this.setturtlemode("wrap");this.showturtle(true);this.pendown(true);this.x=n/2;this.y=r/2;this.r=Math.PI/2;this.resize=function(e,t){n=e;r=t};this.begin();this.end()}